<h3>
    <i class="glyphicon glyphicon-folder-open"></i>
    &nbsp;{{tree['book']['book-meta']['book-id']['#text']}}
</h3>

<div class="row" class="back-matter">
<tabset>
    <tab ng-repeat="(header, content) in tree['book']['back']" heading="{{header}}">
        <!-- glossary -->
        <div ng-if="content.hasOwnProperty('def-list')">
            <table class="table">
                <tr class="no-border-top">
                    <th width="20%">List Title
                        <span ng-if="!tree['book']['book-meta'].hasOwnProperty('series')">
                            <button class="btn btn-default pull-right" ng-click="tree['book']['book-meta']['series'] = '';triggerClick('td.series.book a');">
                                Add
                            </button>
                        </span>
                    </th>
                    <td>
                        <span ng-if="!!content.hasOwnProperty('title')">
                            <a href="#" editable-text="content['title']">
                                {{content['title'] || 'empty'}}
                            </a>
                        </span>
                    </td>
                </tr>
            </table>

            <ul ui-sortable="sortableOptions" ng-model="content['def-list']['def-item']" class="panel-group">
                <li ng-repeat="def in content['def-list']['def-item']" class="panel pane-default">
                    <div class="handle btn btn-default">
                        <i class="glyphicon glyphicon-resize-vertical"></i>
                    </div>
                    <h4 class="panel-title pull-right" ng-model="isOpen" ng-init="false" ng-click="isOpen = !isOpen">
                        <span class="pull-left">{{$index+1}} <a>{{def['term']['#text']}}</a></span>
                        <span class="pull-right" >
                            <i class="glyphicon icon" ng-class="{'glyphicon-chevron-up':isOpen,'glyphicon-chevron-down':!isOpen}"></i>
                        </span>
                    </h4>
                    <div ng-show="isOpen" class="panel-body">
                        <table class="table">
                            <tr class="no-border-top">
                                <th width="10%">Term</th>
                                <td>
                                    <a href="#" editable-text="def['term']['#text']">
                                        {{def['term']['#text'] || 'empty'}}
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th>Description</th>
                                <td>
                                    <a href="#" editable-textangular="def['def']['p']">
                                        <span ng-bind-html="def['def']['p'] || 'empty'"></span>
                                    </a>
                                </td>
                            </tr>
                        </table>
                    </div>
                </li>
            </ul>


        </div>
        <!-- end of glossary -->
        <!-- bibliography -->
        <div ng-if="content.hasOwnProperty('ref')">
            <table class="table">
                <tr class="no-border-top">
                    <th width="20%">List Title
                        <span ng-if="!content.hasOwnProperty('title')">
                            <button class="btn btn-default pull-right"
                                    ng-click="content['title'] = '';triggerClick('td.refListTitle a');">
                                Add
                            </button>
                        </span>
                    </th>
                    <td class="refListTitle">
                        <span ng-if="!!content.hasOwnProperty('title')">
                            <a href="#" editable-text="content['title']">
                                {{content['title'] || 'empty'}}
                            </a>
                        </span>
                    </td>
                </tr>
            </table>


            <ul ui-sortable="sortableOptions" ng-model="content['ref']" class="panel-group">
                <li ng-repeat="ref in content['ref']" class="panel pane-default">
                    <div class="handle btn btn-default">
                        <i class="glyphicon glyphicon-resize-vertical"></i>
                    </div>
                    <h4 class="panel-title pull-right" ng-model="isOpen" ng-init="false" ng-click="isOpen = !isOpen">
                        <span class="pull-left">{{$index+1}}&nbsp;
                            <a>
                                <span ng-if="ref.hasOwnProperty('element-citation')">
                                    {{ref['element-citation']['label']}}
                                </span>
                                <span ng-if="ref.hasOwnProperty('mixed-citation')">
                                    {{ref['element-citation']['label']}}
                                </span>
                            </a>
                        </span>
                        <span class="pull-right" >
                            <i class="glyphicon icon" ng-class="{'glyphicon-chevron-up':isOpen,'glyphicon-chevron-down':!isOpen}"></i>
                        </span>
                    </h4>
                    <div ng-show="isOpen" class="panel-body">
                        <div class="preview-box"><span ng-bind-html="ref['element-citation'] | chicagoStyle"></span></div>
                        <table class="table">
                            <tr class="no-border-top ">
                                <th width="25%">Type</th>
                                <td>
                                    <a editable-select="ref['element-citation']['@publication-type']"
                                       e-ng-options="type for type in bibType">
                                        {{ref['element-citation']['@publication-type'] || 'empty'}}
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th>Label (short name)
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('label')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['label'] = '';triggerClick('td.shortName a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="shortName">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('label')">
                                        <a editable-text="ref['element-citation']['label']" onbeforesave="isEmpty($data)">
                                            {{ref['element-citation']['label'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="['book', 'book chapter', 'journal article', 'newspaper/magazine article', 'website'].indexOf(ref['element-citation']['@publication-type']) >= 0">
                                <th>Book Title
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('source')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['source'] = '';triggerClick('td.source a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="source">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('source')">
                                        <a href="#" editable-text="ref['element-citation']['source']"
                                           onbeforesave="isEmpty($data)">
                                            {{ref['element-citation']['source'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="ref['element-citation']['@publication-type'] === 'book chapter'">
                                <th>Chapter Title
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('chapter-title')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['chapter-title'] = '';triggerClick('td.chapterTitle a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="source">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('chapter-title')">
                                        <a href="#" editable-text="ref['element-citation']['chapter-title']">
                                            {{ref['element-citation']['chapter-title'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="ref['element-citation']['@publication-type'] === 'book chapter'">
                                <th>Chapter Title
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('article-title')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['chapter-title'] = '';triggerClick('td.chapterTitle a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="source">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('chapter-title')">
                                        <a href="#" editable-text="ref['element-citation']['chapter-title']">
                                            {{ref['element-citation']['chapter-title'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <th>Author</th>
                                <td></td>
                            </tr>
                            <tr>
                                <th>Publisher
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('publisher-name')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['publisher-name'] = '';triggerClick('td.publisherName a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="publisherName">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('publisher-name')">
                                        <a href="#" editable-text="ref['element-citation']['publisher-name']">
                                            {{ref['element-citation']['publisher-name'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <th>Location
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('publisher-loc')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['publisher-loc'] = '';triggerClick('td.publisherLoc a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="publisherLoc">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('publisher-loc')">
                                        <a href="#" editable-text="ref['element-citation']['publisher-loc']">
                                            {{ref['element-citation']['publisher-loc'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="ref['element-citation']['@publication-type'] === 'conference proceeding'">
                                <th>Conference name
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('conf-name')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['conf-name'] = '';triggerClick('td.confName a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="confName">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('conf-name')">
                                        <a href="#" editable-text="ref['element-citation']['conf-name']">
                                            {{ref['element-citation']['conf-name'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="ref['element-citation']['@publication-type'] === 'conference proceeding'">
                                <th>Conference Location
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('conf-loc')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['conf-loc'] = '';triggerClick('td.confLoc a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="confLoc">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('conf-loc')">
                                        <a href="#" editable-text="ref['element-citation']['conf-loc']">
                                            {{ref['element-citation']['conf-loc'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <th>Year
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('year')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['year'] = '';triggerClick('td.year a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="year">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('year')">
                                        <a editable-select="ref['element-citation']['year']"
                                           e-ng-options="n for n in [] | range:1900:2020">
                                            {{ref['element-citation']['year'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="ref['element-citation']['@publication-type'] === 'journal article'">
                                <th>Volume
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('volume')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['volume'] = '';triggerClick('td.volume a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="volume">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('volume')">
                                        <a editable-select="ref['element-citation']['volume']"
                                           e-ng-options="n for n in [] | range:1900:2020">
                                            {{ref['element-citation']['volume'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="ref['element-citation']['@publication-type'] === 'journal article'">
                                <th>Number
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('issue')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['issue'] = '';triggerClick('td.issue a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="issue">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('issue')">
                                        <a editable-select="ref['element-citation']['issue']"
                                           e-ng-options="n for n in [] | range:1900:2020">
                                            {{ref['element-citation']['issue'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                            <tr ng-if="ref['element-citation']['@publication-type'] === 'journal article'">
                                <th>Edition
                                    <span ng-if="!ref['element-citation'].hasOwnProperty('edition')">
                                        <button class="btn btn-default pull-right"
                                                ng-click="ref['element-citation']['edition'] = '';triggerClick('td.edition a');">
                                            Add
                                        </button>
                                    </span>
                                </th>
                                <td class="edition">
                                    <span ng-if="!!ref['element-citation'].hasOwnProperty('edition')">
                                        <a editable-select="ref['element-citation']['edition']"
                                           e-ng-options="n for n in [] | range:1900:2020">
                                            {{ref['element-citation']['edition'] || 'empty'}}
                                        </a>
                                    </span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </li>
            </ul>

        </div>
        <!-- end of bibliography -->

    </tab>
</tabset>

</div>

<div class="row">&nbsp;</div>
<div class="row">
    Debug Area
    <pre><code>{{tree['book']['back'] | json}}</code></pre>
</div>
